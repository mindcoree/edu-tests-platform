# Edu Tests Platform

Edu Tests Platform — система для создания, управления и прохождения образовательных тестов. Проект предназначен для использования в учебных заведениях, онлайн-курсах, а также для самостоятельного обучения.

## Основные возможности

- **Создание тестов** — создание тестовых заданий с различными типами вопросов (выбор ответа, открытый вопрос, множественный выбор и др.).
- **Управление пользователями** — поддержка ролей (администратор, преподаватель, студент).
- **Проведение тестирования** — пользователи проходят тесты, результаты сохраняются и доступны для анализа.
- **Аналитика и отчёты** — просмотр статистики по тестам, результатам пользователей, проценту прохождения и ошибкам.
- **Импорт/экспорт данных** — возможность загрузки и выгрузки тестов и результатов в популярных форматах.

## Технологии

- **Backend**: FastAPI, SQLAlchemy, Alembic
- **База данных**: PostgreSQL
- **Хранилище файлов**: Minio S3
- **Аутентификация**: JWT (токен хранится в cookie)
- **Frontend**: отсутствует (только backend)
- **Docker**: проект настроен для запуска в контейнерах Docker

# Требования к окружению

- Python >= 3.11
- PostgreSQL (или другой поддерживаемый БД)
- S3-совместимое хранилище для файлов
- Docker (опционально)
- Переменные окружения для подключения к БД, S3, email и JWT

## Архитектура

- **auth/** — аутентификация, авторизация, управление ролями
- **admin/** — управление пользователями и ролями
- **profile/** — профили пользователей (student, teacher, specialist)
- **s3/** — загрузка и получение файлов через S3
- **common/** — общие типы, конфигурация, пагинация
- **utils/** — вспомогательные функции (работа с JWT, email, S3)


# Структура проекта

```
backend/
├── main.py                # Точка входа FastAPI приложения
├── alembic.ini            # Конфиг Alembic для миграций
├── Dockerfile             # Docker-образ для деплоя
├── prestart.sh            # Скрипт для инициализации
├── requirements.txt       # Зависимости проекта
├── README.md              # Документация
├── admin/                 # Модуль администрирования
│   ├── __init__.py
│   ├── views.py           # API-ручки (эндпоинты)
│   ├── schemas.py         # Pydantic-схемы
│   ├── services.py        # Бизнес-логика
│   ├── exceptions.py      # Обработка ошибок
│   ├── repository.py      # Работа с базой данных
│   ├── models.py          # ORM-модели
│   ├── dependencies.py    # Зависимости для DI
│   └── __pycache__/
├── auth/                  # Аутентификация и авторизация (ручки, сервисы, модели, репозиторий, зависимости, мидлвари)
│   ├── __init__.py
│   ├── dependencies.py
│   ├── middleware.py
│   ├── models.py
│   ├── repository.py
│   ├── schemas.py
│   ├── services.py
│   ├── views.py
│   └── __pycache__/
├── certs/                 # Сертификаты для JWT/SSL
│   ├── private_key.pem
│   ├── public_key.pem
│   └── README.md
├── common/                # Общие компоненты (конфиг, пагинация, типы, enum, миксины)
│   ├── __init__.py
│   ├── base.py
│   ├── config.py
│   ├── db_helper.py
│   ├── enums.py
│   ├── mixins.py
│   ├── paginations.py
│   ├── __pycache__/
│   └── type/
│       ├── __init__.py
│       ├── annotated.py
│       ├── jwt.py
│       └── __pycache__/
├── migrations/            # Миграции Alembic
│   ├── env.py
│   ├── README
│   ├── script.py.mako
│   ├── __pycache__/
│   └── versions/
├── profile/               # Профили пользователей (student, teacher, specialist)
│   ├── __init__.py
│   ├── __pycache__/
│   ├── specialist/
│   │   ├── __init__.py
│   │   ├── dependencies.py
│   │   ├── models.py
│   │   ├── repository.py
│   │   ├── schemas.py
│   │   ├── services.py
│   │   ├── views.py
│   ├── student/
│   │   ├── __init__.py
│   │   ├── dependencies.py
│   │   ├── exceptions.py
│   │   ├── models.py
│   │   ├── repository.py
│   │   ├── schemas.py
│   │   ├── services.py
│   │   ├── views.py
│   │   └── __pycache__/
│   ├── teacher/
│   │   ├── __init__.py
│   │   ├── dependencies.py
│   │   ├── exceptions.py
│   │   ├── models.py
│   │   ├── repository.py
│   │   ├── schemas.py
│   │   ├── services.py
│   │   ├── views.py
│   │   └── __pycache__/
├── s3/                    # Работа с файлами и изображениями через S3
│   ├── __init__.py
│   ├── schemas.py
│   └── views.py
├── utils/                 # Вспомогательные утилиты (работа с S3, email, JWT)
│   ├── __init__.py
│   ├── auth.py
│   ├── email.py
│   ├── s3.py
│   └── __pycache__/
```
## Принципы организации кода

Порядок слоев в каждом модуле:

```
views.py → schemas.py → services.py → exceptions.py → repository.py → models.py
```

- **views.py** — API-ручки (эндпоинты)
- **schemas.py** — Pydantic-схемы для валидации данных
- **services.py** — бизнес-логика
- **exceptions.py** — обработка ошибок и бизнес-исключения
- **repository.py** — работа с базой данных
- **models.py** — ORM-модели
- **dependencies.py** — зависимости для DI

Такой подход обеспечивает чистую архитектуру, удобную поддержку и расширяемость.


### Аутентификация и авторизация (`/auth`)

| Endpoint | Метод | Описание |
|---|---|---|
| `/auth/register` | POST | Регистрация нового пользователя. В теле запроса передаются данные пользователя (email, пароль, роль и др). Возвращает созданного пользователя. | 
| `/auth/login` | POST | Вход в систему. В теле запроса email и пароль. Возвращает access и refresh токены. | 
| `/auth/refresh` | POST | Обновление access токена по refresh токену. | Требуется refresh токен |
| `/auth/role-request` | POST | Запрос на смену роли (например, студент → преподаватель). В теле запроса указывается желаемая роль. | Требуется авторизация |
| `/auth/password-reset/request` | POST | Запрос на сброс пароля. В теле запроса email пользователя. На email отправляется код подтверждения. | Без авторизации |
| `/auth/password-reset/confirm` | POST | Подтверждение сброса пароля по коду из email. В теле запроса email, код и новый пароль. | Без авторизации |

### Админ-панель (`/admin`)

| Endpoint | Метод | Описание |
|---|---|---|
| `/admin/create` | POST | Создать нового администратора. В теле запроса указываются данные нового пользователя (например, email, имя, роль). Возвращает созданного администратора. |
| `/admin/change-role-entity` | PATCH | Изменить роль пользователя (например, назначить преподавателем или специалистом). В теле запроса указывается id пользователя и новая роль. Возвращает обновлённые данные пользователя. |
| `/admin/entities` | GET | Получить список всех пользователей с возможностью фильтрации и пагинации. Можно искать по email, роли, статусу. Возвращает массив пользователей. |
| `/admin/get/entity/{entity_id}` | GET | Получить подробную информацию о пользователе по id (email, роль, статус, дата регистрации и др). |
| `/admin/delete/entity/{entity_id}` | DELETE | Удалить пользователя по id. После удаления пользователь больше не сможет войти в систему. |
| `/admin/role-requests` | GET | Получить список заявок на смену роли. Можно фильтровать по статусу заявки, использовать пагинацию. Возвращает массив заявок. |
| `/admin/role-request/{request_id}/approve` | POST | Одобрить заявку на смену роли. Пользователь получит новую роль и уведомление. |
| `/admin/role-request/{request_id}/reject` | POST | Отклонить заявку на смену роли. Пользователь получит уведомление об отказе. |

### Работа с файлами (`/s3`)

| Endpoint | Метод | Описание |
|---|---|---|
| `/s3/image/{image_key}` | GET | Получить изображение по ключу из S3. В ответе приходит файл изображения (например, JPEG/PNG). |
| `/s3/upload/image` | POST | Загрузить изображение в S3. В теле запроса передаётся файл (multipart/form-data). Возвращает ключ и публичную ссылку на изображение. |

### Студент (`/student`)

| Endpoint | Метод | Описание |
|---|---|---|
| `/student/tests` | GET | Получить список всех доступных тестов для студента с фильтрацией и пагинацией. В ответе массив тестов с краткой информацией. |
| `/student/attempts` | GET | Получить историю всех попыток прохождения тестов (пройденные и текущие). В ответе массив попыток с датой, результатом и статусом. |
| `/student/stats` | GET | Получить общую статистику по своим тестам (количество попыток, средний балл, процент правильных ответов и др). |
| `/student/tests/{test_id}` | GET | Получить подробную информацию о выбранном тесте для прохождения (вопросы, описание, статус, время на выполнение). |
| `/student/tests/{test_id}/start` | POST | Начать новую попытку прохождения теста, получить идентификатор попытки и стартовые данные. |
| `/student/attempts/{attempt_id}/answer` | POST | Отправить ответ на вопрос в рамках попытки, получить результат по вопросу (правильность, баллы, комментарий). |
| `/student/attempts/{attempt_id}/finish` | POST | Завершить попытку теста и получить итоговый результат (общий балл, список правильных/неправильных ответов, статистика). |

### Преподаватель (`/teacher`)

| Endpoint | Метод | Описание |
|---|---|---|
| `/teacher/tests/test/add` | POST | Создать новый тест. В теле запроса параметры теста (название, описание, вопросы и др). Возвращает созданный тест с id. |
| `/teacher/tests/show` | GET | Получить список всех тестов преподавателя с фильтрацией, пагинацией и по статусу (черновик, опубликован, архив). В ответе массив тестов. |
| `/teacher/tests/test/delete/{test_id}` | DELETE | Удалить тест по идентификатору. После удаления тест становится недоступен для студентов. |
| `/teacher/tests/test/edit/{test_id}` | PATCH | Редактировать параметры теста (название, описание, вопросы и др). Возвращает обновлённый тест. |
| `/teacher/tests/{test_id}/questions/add` | POST | Добавить новый вопрос с вариантами ответа к тесту. В теле запроса текст вопроса, варианты, правильный ответ. |
| `/teacher/tests/delete/all` | DELETE | Удалить все тесты преподавателя. |
| `/teacher/tests/{test_id}/questions/delete/all` | DELETE | Удалить все вопросы выбранного теста. |
| `/teacher/tests/{test_id}/questions/delete/{question_id}` | DELETE | Удалить конкретный вопрос из теста. |
| `/teacher/tests/{test_id}/duplicate` | POST | Создать копию теста со всеми вопросами. Возвращает новый тест. |
| `/teacher/tests/{test_id}/publish` | POST | Опубликовать тест (делает его доступным для студентов). |
| `/teacher/tests/{test_id}/archive` | POST | Архивировать тест (скрыть из общего доступа). |
| `/teacher/tests/{test_id}/questions/{question_id}` | GET | Получить подробную информацию о вопросе по id (текст, варианты, правильный ответ, статистика). |
| `/teacher/tests/students` | GET | Получить список всех студентов, проходивших тесты данного преподавателя (с фильтрацией и пагинацией). |
| `/teacher/tests/{test_id}` | GET | Получить подробную информацию о тесте, включая все вопросы и варианты ответов. |
| `/teacher/tests/{test_id}/questions/edit/{question_id}` | PATCH | Редактировать вопрос и варианты ответа. |
| `/teacher/tests/{test_id}/results` | GET | Получить результаты прохождения теста всеми студентами (баллы, ответы, статистика по вопросам). |
| `/teacher/tests/{test_id}/analytics` | GET | Получить аналитику по тесту (статистика, средний балл, сложность вопросов, процент правильных ответов и др). |
| `/teacher/tests/students/{student_id}/results` | GET | Получить результаты конкретного студента по всем тестам преподавателя (баллы, ответы, динамика). |

## Авторизация и роли

- Для доступа к защищённым ручкам требуется JWT access-токен (передаётся через cookie)
- Роли: student, teacher, specialist, admin
- Запрос на смену роли через `/auth/role-request`


## Быстрый старт

1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/mindcoree/edu-tests-platform.git
    ```
2. Ознакомьтесь с проектом — структура и основной функционал описаны в этом README.
3. Настройте переменные окружения для доступа к базе данных PostgreSQL и Minio S3 (см. пример `.env` файла).
4. Примените миграции базы данных:
    ```bash
    alembic upgrade head
    ```
5. Запустите приложение локально:
    ```bash
    pip install -r requirements.txt
    uvicorn app.main:app --reload
    ```
6. Для удобного развёртывания используйте Docker (docker-compose файлы уже настроены):
    ```bash
    docker-compose up --build
    ```

Приложение будет доступно по адресу `http://localhost:8000`

## Документация

- [Документация API](docs/api.md)  
- [Инструкция по развертыванию](docs/deployment.md)  
- [Описание структуры БД](docs/database.md)

## Вклад

Если вы хотите внести вклад, пожалуйста, создайте issue или pull request. Мы приветствуем любые предложения по улучшению платформы!

## Лицензия

Проект распространяется под лицензией MIT.

---

**Контакты:**  
Для вопросов и предложений пишите на email: cardinall1304@gmail.com  
Telegram: [@min_dcore](https://t.me/min_dcore)
